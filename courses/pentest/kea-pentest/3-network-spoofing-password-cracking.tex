\documentclass[Screen16to9,17pt]{foils}
\usepackage{zencurity-slides}

\externaldocument{kea-pentest-exercises}
\selectlanguage{english}

%VF 3 Netværkspenetrationstest (5 ECTS)
% Indhold
%Den studerende lærer om hvordan en penetration test udføres, samt kan indhente oplysninger om de seneste sårbarheder, og kan benytte sig af de relevante værktøjer til dette formål.
%Viden
%Den studerende viden om og forståelse for:
%* Etiske samt kontraktuelle forhold omkring en penetrationstest.
%* Standardiseringorganisationers og myndigheders krav til og om penetrationstesting
%Færdigheder
%Den studerende kan:
%Tage højde for sikkerhedsaspekter ved at:
%* Anvende relevante metoder ved udførsel af en penetrationstest
%* Udarbejde en angrebsplan ud fra indsamlede oplysninger om et mål
%* Finde sårbarheder i et givet system
% * Dokumentere og rapportere fundne sårbarheder
% Kompetencer
%Den studerende kan:
% * Planlægge en penetration test, samt eksekvere den både ved brug af værktøjer og manuelt.


\begin{document}

\mytitlepage
{3. Network spoofing and Cracking Passwords}
{KEA Kompetence Penetration Testing}




\slide{Plan for today}

\begin{list1}
\item Subjects
\begin{list2}
\item Network spoofing and Cracking Passwords
\item Some sniffing, some wireless
\item ARP spoofing, ICMP redirects, the classics
\item Person in the middle attacks
\item Brute force attacks
\item Powershell - we really should, but sorry. Home exercise
\end{list2}
\item Exercises
\begin{list2}
\item ARP spoofing and ettercap
\item EtherApe
\item Pcap-diff
\end{list2}
\item  Reading Curriculum:
\begin{list2}
\item Grayhat chapters 10,15
\end{list2}
%\item  Reading Related resources:
%\begin{list2}
%\item
%\end{list2}
\end{list1}



\slide{Goals for today: Non-exploit methods}
\vskip 2 cm

\hlkimage{13cm}{50-most-used-passwords.png}

\begin{list2}
\item Getting shells without exploits -
 Living of the land - use existing features and programs
\item Badly configured systems exist
\item Using passwords like admin/admin or SNMP with community string {public} or {private}
\end{list2}



\slide{POP3 - trådløst}

\hlkimage{10cm}{images/pop3-wlan.pdf}
\begin{list1}
\item Har man tillid til andre ISP'er? Alle ISP'er?
\item Deler man et netværksmedium med andre?
\end{list1}



\slide{POP3 netværk}

\hlkimage{10cm}{dsniff-passwords.png}

\centerline{Dsniff screenshot, vi viser måske tilsvarende i Wireshark}

Dsniff er et godt demo program til arpspoofing mv., Ettercap er mere moderne



\slide{Person in the middle attacks}

\begin{list1}
\item ARP spoofing, ICMP redirects, the classics
\item Used to be called Man in The Middle MiTM
\begin{list2}
\item ICMP redirect
\item ARP spoofing
\item Wireless listening and spoofing higher levels like  airpwn-ng \link{https://github.com/ICSec/airpwn-ng}
\end{list2}
\item Usually aimed at unencrypted protocols
\item Today we only talk about getting the data, not how to perform higher level attacks
\end{list1}


\slide{ICMP redirect}

\begin{list1}
\item Routere understøtter ofte ICMP Redirect
\item Med ICMP Redirect kan man til en afsender fortælle en anden vej til destination
\item Den angivne vej kan være smartere eller mere effektiv
\item Det er desværre uheldigt, idet der ingen sikkerhed er
\item Idag bør man ikke lytte til ICMP redirects, ej heller generere dem
\item Det svarer til ARP spoofing, idet trafik omdirigeres
\end{list1}


\slide{New Loki - ikke alt er layer 7}

\begin{quote}
At the beginning LOKI was made to combine some stand-alone {\bf command line tools}, like the \verb+bgp_cli+, the \verb+ospf_cli+
or the \verb+ldp_cli+ and to give them a {\bf user friendly, graphical interface}. In the meantime LOKI is more than just the comb
ination of the single tools, it gave its modules the opportunity to base upon each other (like {\bf combining ARP-spoofing from th
e ARP module with some man-in-the-middle actions, rewriting MPLS-labels for example)} and even inter operate with each other. (Fre
mh<E6>vning: HLK)
\end{quote}

\begin{list1}
\item \link{https://www.c0decafe.de/loki.html} Loki
\item \link{http://www.packetstan.com/2011/02/running-loki-on-backtrack-4-r2.html}
\item "Yersinia is a network tool designed to take advantage of some weakeness in different network protocols. It pretends to be a solid framework for analyzing and testing the deployed networks and systems."  \link{http://www.yersinia.net/}
\end{list1}




\slide{Hvordan virker ARP spoofing?}

\hlkimage{10cm}{images/arp-spoof.pdf}

\begin{list1}
\item Hackeren sender forfalskede ARP pakker til de to parter
\item De sender derefter pakkerne ud på Ethernet med hackerens MAC
  adresse som modtager - som får alle pakkerne
\end{list1}

\slide{Forsvar mod ARP spoofing}

\begin{list1}
\item Hvad kan man gøre?
\item låse MAC adresser til porte på switche
\item låse MAC adresser til bestemte IP adresser
\item Efterfølgende administration!
\vskip 1 cm
\item Adskilte netværk - brug IEEE 802.1q VLANs
\item {\bfseries arpwatch er et godt bud} - overvåger ARP
\item bruge protokoller som ikke er sårbare overfor opsamling
\end{list1}

\slide{Lufthavns wifi}

Åbne trådløse netværk er dejlige, vi bruger dem allesammen.

\begin{alltt}\small
http://wifi.aal.dk/fs/customwebauth/login.html?
switch_url=http://wifi.aal.dk/login.html&ap_mac=70:db:98:73:e5:a0&
\bf{client_mac=30:10:b3:XX:YY:ZZ}&wlan=AALfree&redirect=www.gstatic.com/generate_204
\end{alltt}

\begin{list2}
\item Når du forbinder til netværket, bruger din enhed sin MAC adresse
\item Denne indeholder en OUI som er den første halvdel af de 48-bit
\item Dette ID er gemt i din enhed, fra fabrikken, kan sjældent ændres
\item Alle i nærheden kan se denne MAC, og dermed din enheds unikke hardwareadresse.
\item Kendere ved at man kan skifte sin MAC midlertidigt, og det gør telefoner ofte når de scanner efter netværk idag - hvis de overhovedet scanner
\end{list2}



\slide{Demo Attacks fun with nodes}

\hlkimage{8cm}{etherape-2018.png}

\begin{quote}
EtherApe is a graphical network monitor for Unix modeled after etherman. Featuring link layer, IP and TCP modes, it displays network activity graphically. Hosts and links change in size with traffic. Color coded protocols display.
\end{quote}

\begin{list1}
\item How do we find nodes to perform ARP spoofing?
\item The main page for the tool is:
\link{https://etherape.sourceforge.io/}
\end{list1}


\slide{Chaosreader}

\hlkimage{20cm}{chaosreader2.png}
\begin{list1}
\item Simple but illustrative program
\item Read a pcap - packet capture into this tool chaosreader
\item Output HTML with nice index - usefull for quick demos
\item \link{http://chaosreader.sourceforge.net/}

\end{list1}

\slide{Big data example Moloch}

\hlkimage{12cm}{moloch-sessions.png}

Picture from \link{https://github.com/aol/moloch}\\
Be your own GCHQ ... capture all, index all, search all


\exercise{ex:zeekweb}

\exercise{ex:mirrorport}

\slide{Normal WLAN brug}

\hlkimage{17cm}{images/wlan-airpwn-1.pdf}

\slide{Packet injection - airpwn}

\hlkimage{17cm}{images/wlan-airpwn-2.pdf}

\slide{Airpwn teknikker}

\begin{list1}
\item Klienten sender forespørgsel
\item Hackerens program airpwn lytter og sender så falske pakker
\item Hvordan kan det lade sig gøre?
\begin{list2}
\item Normal forespørgsel og svar på Internet tager måske 20-50ms
\item Airpwn kan svare på omkring 1ms angives det
\item Airpwn har alle informationer til rådighed
\end{list2}
\item Airpwn source findes på Sourceforge\\
\link{http://airpwn.sourceforge.net/}
\item NB: Airpwn som demonstreret er begrænset til TCP og ukrypterede
  forbindelser
\item Mange Wireless netværk idag er ukrypterede og samme teknikker kan bruges idag
\end{list1}

\centerline{Ja, de {\bf samme metoder} oprindeligt fra {\bf 2004} kan bruges idag!}

\exercise{ex:wardriving}

\input{../../../presentations/pentest/pentest-III-foredrag/basic-crypto.tex}


\slide{SSL og TLS}

\hlkimage{10cm}{ehandel-https.pdf}

\begin{list1}
\item Oprindeligt udviklet af Netscape Communications Inc.
\item Secure Sockets Layer SSL er idag blevet adopteret af IETF og kaldes
derfor også for Transport Layer Security TLS
TLS er baseret på SSL Version 3.0
\item RFC-2246 The TLS Protocol Version 1.0 fra Januar 1999
\item RFC-3207 SMTP STARTTLS
\end{list1}


\slide{SSL}

\begin{quote}
The 'S' in HTTPS stands for 'secure' and the security is provided by SSL/TLS. SSL/TLS is a standard network protocol which is implemented in every browser and web server to provide confidentiality and integrity for HTTPS traffic.
\end{quote}

\begin{list1}
\item Nu vi snakker om kryptering - SSL overalt?
\item Kan vi klare det på vores servere?
\pause
\item Google kan:\\
\link{http://www.imperialviolet.org/2010/06/25/overclocking-ssl.html}
\item Men alt for få gør det
\end{list1}
\pause
\centerline{Næste spørgsmål er så hvilke rod-certifikater man stoler på ...}



\slide{Weak DH paper}

\hlkimage{14cm}{weakdh-logjam.png}

Source: \link{https://weakdh.org/} and \\
\link{https://weakdh.org/imperfect-forward-secrecy-ccs15.pdf}

\slide{PRNG}

\hlkimage{22cm}{debian-prng.png}

{\small\link{https://en.wikipedia.org/wiki/Random_number_generator_attack\#Debian_OpenSSL}}

\centerline{The random number generator is VITAL for crypto security}

Check out modern CPUs and Linux response to this\\
 \link{https://en.wikipedia.org/wiki/RdRand}



\slide{sslscan}

\begin{alltt}\small
root@kali:~# sslscan --ssl2 web.gratisdns.dk
Version: 1.10.5-static
OpenSSL 1.0.2e-dev xx XXX xxxx

Testing SSL server web.gratisdns.dk on port 443
...
  SSL Certificate:
Signature Algorithm: sha256WithRSAEncryption
RSA Key Strength:    2048

Subject:  *.gratisdns.dk
Altnames: DNS:*.gratisdns.dk, DNS:gratisdns.dk
Issuer:   AlphaSSL CA - SHA256 - G2
\end{alltt}

Source:
Originally sslscan from http://www.titania.co.uk
 but use the version on Kali


 \slide{IPsec IKE-SCAN}

 Scan IPs for VPN endpoints with ike-scan:
 \begin{alltt}\small
 root@kali:~# ike-scan 91.102.91.30
 Starting ike-scan 1.9 with 1 hosts
 (http://www.nta-monitor.com/tools/ike-scan/)
 91.102.91.30	Notify message 14 (NO-PROPOSAL-CHOSEN)
 HDR=(CKY-R=f0d6043badb2b7bc, msgid=f97a7508)

 Ending ike-scan 1.9: 1 hosts scanned in 1.238 seconds (0.81 hosts/sec).
 0 returned handshake; 1 returned notify
 \end{alltt}

 Source:\\
 {\small\link{http://www.nta-monitor.com/tools-resources/security-tools/ike-scan}}

 crack IKE psk?\\
 {\footnotesize
 \link{http://ikecrack.sourceforge.net/} \\
 \link{https://www.trustwave.com/Resources/SpiderLabs-Blog/Cracking-IKE-Mission-Improbable-(Part-1)/}}

 \slide{ike-scan network scanning}

 \begin{alltt}\footnotesize
 hlk@cornerstone03:~$ sudo ike-scan -M 91.102.91.0/24
 Starting ike-scan 1.9 with 256 hosts
 (http://www.nta-monitor.com/tools/ike-scan/)
 91.102.91.14	Notify message 14 (NO-PROPOSAL-CHOSEN)
 	HDR=(CKY-R=94dd41cf44da082b, msgid=602c35c1)
 91.102.91.30	Notify message 14 (NO-PROPOSAL-CHOSEN)
 	HDR=(CKY-R=e21e89d16f898aa5, msgid=ff41d51c)
 91.102.91.70	Notify message 14 (NO-PROPOSAL-CHOSEN)
 	HDR=(CKY-R=e882d9b4477b847b, msgid=55be4339)
 91.102.91.78	Notify message 14 (NO-PROPOSAL-CHOSEN)
 	HDR=(CKY-R=1fc54d8c3042daa3, msgid=ea705f39)
 91.102.91.150	Notify message 14 (NO-PROPOSAL-CHOSEN)
 	HDR=(CKY-R=d5470f881de6d2d9, msgid=2bf5f5ef)
 91.102.91.158	Notify message 14 (NO-PROPOSAL-CHOSEN)
 	HDR=(CKY-R=9f7af04bcb0152a9, msgid=44f26f01)
 Ending ike-scan 1.9: 256 hosts scanned in 40.465 seconds (6.33 hosts/sec).
 0 returned handshake; 6 returned notify
 \end{alltt}



\exercise{ex:SSLScanner}

\exercise{ex:pcap-diff}

\exercise{ex:etherape}

\exercise{ex:arp-spoof-ettercap}



\slide{Når adgangen er skabt}

\begin{list1}
\item Så går man igang med de almindelige værktøjer
\item SecTools.Org: Top 125 Network Security Tools \link{http://www.sectools.org}
\end{list1}
\vskip 2 cm

\centerline{\hlkbig Forsvaret er som altid - flere lag af sikkerhed! }

\slide{Infrastrukturændringer}

\hlkimage{13cm}{images/wlan-accesspoint-2.pdf}

\centerline{Sådan bør et access point logisk forbindes til netværket}




\slide{VLAN Virtual LAN}

\hlkimage{8cm}{vlan-portbased.pdf}

\begin{list2}
\item Nogle switche tillader at man opdeler portene
\item Denne opdeling kaldes VLAN og portbaseret er det mest simple
\item Port 1-4 er et LAN
\item De resterende er et andet LAN
\item Data skal omkring en firewall eller en router for at krydse fra VLAN1 til VLAN2
\end{list2}

\slide{IEEE 802.1q}

\hlkimage{13cm}{vlan-8021q.pdf}

\begin{list2}
\item Nogle switche tillader at man opdeler portene, men tillige benytter 802.1q
\item Med 802.1q tillades VLAN tagging på Ethernet niveau
\item Data skal omkring en firewall eller en router for at krydse fra VLAN1 til VLAN2
\item VLAN trunking giver mulighed for at dele VLANs ud på flere switches
\item Der findes værktøjer der måske kan lette dette arbejde management værktøjer, provisioneringsværktøjer osv. Network Automation with Python
\end{list2}




\slide{Github Public passwords?}


\hlkimage{14cm}{github-credentials.png}

 Sources:\\
{\footnotesize\link{https://twitter.com/brianaker/status/294228373377515522}\\
\link{http://www.webmonkey.com/2013/01/users-scramble-as-github-search-exposes-passwords-security-details/}\\
\link{http://www.leakedin.com/}\\
\link{http://www.offensive-security.com/community-projects/google-hacking-database/}
}

\vskip 5mm
\centerline{Use different passwords for different sites, yes - every site!}


\slide{Simple Network Management Protocol}

\begin{list1}
\item SNMP er en protokol der supporteres af de fleste professionelle
  netværksenheder, såsom switche, routere
\item hosts -- skal slås til men følger som regel med
\item SNMP bruges til:
  \begin{list2}
    \item \emph{network management}
    \item statistik
    \item rapportering af fejl -- SNMP traps
  \end{list2}
\item {\bfseries Sikkerheden baseres på community strings der sendes
    som klartekst ...}
\item Det er nemmere at brute-force en community string end en
  brugerid/kodeord kombination
\end{list1}


\slide{Passwords vælges ikke tilfældigt}

\hlkimage{20cm}{50-most-used-passwords.png}

Source:
\link{https://wpengine.com/unmasked/}



\slide{Brute force}

\begin{list1}
\item Hvad betyder bruteforcing?\\
afprøvning af alle mulighederne
\end{list1}

\begin{alltt}\small
Hydra v2.5 (c) 2003 by van Hauser / THC <vh@thc.org>
Syntax: hydra [[[-l LOGIN|-L FILE] [-p PASS|-P FILE]] | [-C FILE]]
[-o FILE] [-t TASKS] [-g TASKS] [-T SERVERS] [-M FILE] [-w TIME]
[-f] [-e ns] [-s PORT] [-S] [-vV] server service [OPT]

Options:
  -S        connect via SSL
  -s PORT   if the service is on a different default port, define it here
  -l LOGIN  or -L FILE login with LOGIN name, or load several logins from FILE
  -p PASS   or -P FILE try password PASS, or load several passwords from FILE
  -e ns     additional checks, "n" for null password, "s" try login as pass
  -C FILE   colon seperated "login:pass" format, instead of -L/-P option
  -M FILE   file containing server list (parallizes attacks, see -T)
  -o FILE   write found login/password pairs to FILE instead of stdout
...
\end{alltt}


\demo{snmpwalk og Hydra}

Vi laver sammen noget SNMP scanning og bruteforcing, derefter er det jeres tur

\exercise{ex:snmpwalk}

\exercise{ex:hydra-brute}

\slide{Are passwords dead?}

\hlkimage{4cm}{rip-passwords.pdf}

Can we stop using passwords?

Muffett on Passwords has a long list of password related information, from the author of crack \link{http://en.wikipedia.org/wiki/Crack_(password_software)}

\link{http://dropsafe.crypticide.com/muffett-passwords}


\slide{NT hashes}

\begin{list1}
  \item NT LAN manager hash værdier er noget man typisk kan samle op i
  netværk
\item det er en hash værdi af et password som man ikke burde kunne
  bruge til noget - hash algoritmer er envejs
\item opbygningen gør at man kan forsøge brute-force på 7 tegn ad
  gangen!
\item en moderne pc med l0phtcrack kan nemt knække de fleste password
  på få dage!
\item og sikkert 25-30\% indenfor den første dag - hvis der ingen
  politik er omkring kodeord!
\item ved at generere store tabeller, eksempelvis 100GB kan man dække
  mange hashværdier af passwords med almindelige bogstaver, tal og
  tegn - og derved knække passwordshashes på sekunder. Søg efter
  rainbowcrack med google
\end{list1}

\slide{l0phtcrack LC4}

\hlkimage{7cm}{images/lc4_splash.png}

\begin{alltt}
\small
Consider that at one of the largest technology companies, where policy
required that passwords exceed 8 characters, mix cases, and include
numbers or symbols...

L0phtCrack obtained 18\% of the passwords in 10 minutes
90\% of the passwords were recovered within 48 hours on a Pentium II/300
The Administrator and most Domain Admin passwords were cracked
\link{http://www.atstake.com/research/lc/}
\end{alltt}

\slide{Pass the hash}

Lots of tools in pentesting pass the hash, reuse existing credentials and tokens
\emph{Still Passing the Hash 15 Years Later}\\
\link{http://passing-the-hash.blogspot.dk/2013/04/pth-toolkit-for-kali-interim-status.html}

\begin{quote}
If a domain is built using only modern Windows OSs and COTS products (which know how to operate within these new constraints), and configured correctly with no shortcuts taken, then these protections represent a big step forward.
\end{quote}

Source:\\
{\small\link{http://www.harmj0y.net/blog/penetesting/pass-the-hash-is-dead-long-live-pass-the-hash/}
\link{https://samsclass.info/lulz/pth-8.1.htm}}

\slide{Mimikatz}

\begin{quote}
mimikatz is a tool I've made to learn C and make somes experiments with Windows security.

It's now well known to extract plaintexts passwords, hash, PIN code and kerberos tickets from memory. mimikatz can also perform pass-the-hash, pass-the-ticket or build Golden tickets.
\end{quote}

\begin{list2}
\item Understatement of the year, candidate
\item Proof of concept code, that is abused a lot by everyone, malware to pentesters
\item \url{https://github.com/gentilkiwi/mimikatz}
\end{list2}

\centerline{Your anti-virus application SHOULD catch mimikatz}

\slide{Cain og Abel}

%\hlkimage{10cm}{cain_brute_attack.jpg}
\hlkimage{15cm}{cain-win.png}

\begin{list1}
\item Cain og Abel \emph{anbefales til demoer}  \link{http://www.oxid.it}
\item Bruger selv John the Ripper eller Hashcat hvis jeg skal lave brute forcing
\end{list1}


\slide{John the Ripper}

\begin{quote}
John the Ripper is a fast password cracker, currently available for
many flavors of Unix (11 are officially supported, not counting
different architectures), Windows, DOS, BeOS, and OpenVMS. Its primary
purpose is to detect weak Unix passwords. Besides several crypt(3)
password hash types most commonly found on various Unix flavors,
supported out of the box are Kerberos AFS and Windows NT/2000/XP/2003
LM hashes, plus several more with contributed patches.
\end{quote}

\begin{list1}
\item Unix passwords kan knækkes med alec Muffets kendte Crack program
  eller eksempelvis John the Ripper \link{http://www.openwall.com/john/}
\item Jeg bruger selv John the Ripper
\end{list1}

\slide{Cracking passwords}

\begin{list2}
\item Hashcat is the world's fastest CPU-based password recovery tool.
\item oclHashcat-plus is a GPGPU-based multi-hash cracker using a brute-force attack (implemented as mask attack), combinator attack, dictionary attack, hybrid attack, mask attack, and rule-based attack.
\item oclHashcat-lite is a GPGPU cracker that is optimized for cracking performance. Therefore, it is limited to only doing single-hash cracking using Markov attack, Brute-Force attack and Mask attack.
\item John the Ripper password cracker old skool men stadig nyttig
\end{list2}

Source:\\
\link{https://hashcat.net/wiki/}\\
\link{http://www.openwall.com/john/}

\slide{Parallella John}

\hlkimage{17cm}{parallella-john.png}

\link{https://twitter.com/solardiz/status/492037995080712192}

\begin{list1}
\item FPGA hacking er populært
\item Dog mange forskellige hardware systemer/modeller
\item Ringere support for algoritmer
\end{list1}


\slide{Stacking Parallella boards}
\hlkimage{10cm}{4BoardStack.jpg}

FPGA og ASICS må vi forvente at eksempelvis NSA bruger\\
{\footnotesize
\link{https://www.parallella.org/}\\ \link{https://en.wikipedia.org/wiki/Application-specific_integrated_circuit}}


\demo{Playtime - speed test openssl speed, John speed}

\demo{Cain/Abel, hashcat or John the Ripper }

Try as many as you like

Grab sample hashes from your local system or\\
 \link{https://hashcat.net/wiki/doku.php?id=example_hashes}



\slide{Encryption key length}

\hlkimage{10cm}{encryption-crack.png}

Source: \link{http://www.mycrypto.net/encryption/encryption_crack.html}

More up to date:
In 1998, the EFF built Deep Crack for less than \$250,000\\
{\footnotesize\link{https://en.wikipedia.org/wiki/EFF_DES_cracker}}\\
FPGA Based UNIX Crypt Hardware Password Cracker - ~100 EUR in 2006\\
{\footnotesize\link{http://www.sump.org/projects/password/}}


\slide{WEP sikkerhed}

\hlkimage{12cm}{images/airsnort.pdf}

\begin{quote}
AirSnort is a wireless LAN (WLAN) tool which recovers encryption
keys. AirSnort operates by passively monitoring transmissions,
computing the encryption key when enough packets have been gathered.

802.11b, using the Wired Equivalent Protocol (WEP), is crippled with
numerous security flaws. Most damning of these is the weakness
described in " Weaknesses in the Key Scheduling Algorithm of RC4 "
by Scott Fluhrer, Itsik Mantin and Adi Shamir. Adam Stubblefield
was the first to implement this attack, but he has not made his
software public. AirSnort, along with WEPCrack, which was released
about the same time as AirSnort, are the first publicly available
implementaions of this attack.  \link{http://airsnort.shmoo.com/}
\end{quote}

%\begin{list1}
%\item i dag er firmware opdateret hos de fleste producenter
%\item men sikkerheden baseres stadig på een delt hemmelighed
%\end{list1}

\slide{major cryptographic errors}

\begin{list1}
\item weak keying - 24 bit er allerede kendt - 128-bit = 104 bit i praksis
\item small IV - med kun 24 bit vil hver IV blive genbrugt oftere
\item CRC-32 som integritetscheck er ikke \emph{stærkt} nok
  kryptografisk set
\item Authentication gives pad - giver fuld adgang - hvis der bare
  opdages \emph{encryption pad} for en bestemt IV. Denne IV kan så
  bruges til al fremtidig kommunikation
\end{list1}
Source:
\emph{Secure Coding: Principles and Practices}, Mark G. Graff
  og Kenneth R. van Wyk, O'Reilly, 2003

\slide{Konklusion: Kryptografi er svært}

%Stoler vi på de andre autentificeringsmetoder?}
\hlkimage{20cm}{crypto-class.png}

Åbent kursus på Stanford\\
\link{http://crypto-class.org/}



\slide{WEP cracking - airodump og aircrack}

\hlkimage{3cm}{images/no-wep.pdf}

\begin{list1}
\item airodump - opsamling af krypterede pakker
\item aircrack - statistisk analyse og forsøg på at finde WEP nøglen
\item Med disse værktøjer er det muligt at knække \emph{128-bit nøgler}!
\item Blandt andet fordi det reelt er 104-bit nøgler \smiley
\item Links:\\
Tutorial: Simple WEP Crack\\
\link{http://www.aircrack-ng.org/doku.php?id=simple_wep_crack}
\end{list1}

\slide{airodump opsamling}


\begin{alltt}
\hlktiny
   BSSID              CH  MB  ENC  PWR  Packets   LAN IP / # IVs   ESSID

   00:03:93:ED:DD:8D   6  11       209   {\bf 801963                  540180}   wanlan
\end{alltt}

\begin{list1}
\item Når airodump kører opsamles pakkerne
\item Lås airodump fast til een kanal, -c eller --channel
\end{list1}

Startes med airmon og kan skrive til capture filer:

\begin{alltt}
airmon-ng start wlan0
airodump-ng --channel 6 --write testfil wlan0mon
\end{alltt}

\slide{aircrack - WEP cracker}

\begin{alltt}
\footnotesize
   $ aircrack -n 128 -f 2 aftendump-128.cap
                                 aircrack 2.1
   * Got  540196! unique IVs | fudge factor = 2
   * Elapsed time [00:00:22] | tried 12 keys at 32 k/m
   KB    depth   votes
    0    0/  1   CE(  45) A1(  20) 7E(  15) 98(  15) 72(  12) 82(  12)
    1    0/  2   62(  43) 1D(  24) 29(  15) 67(  13) 94(  13) F7(  13)
    2    0/  1   B6( 499) E7(  18) 8F(  15) 14(  13) 1D(  12) E5(  10)
    3    0/  1   4E( 157) EE(  40) 29(  39) 15(  30) 7D(  28) 61(  20)
    4    0/  1   93( 136) B1(  28) 0C(  15) 28(  15) 76(  15) D6(  15)
    5    0/  2   E1(  75) CC(  45) 39(  31) 3B(  30) 4F(  16) 49(  13)
    6    0/  2   3B(  65) 51(  42) 2D(  24) 14(  21) 5E(  15) FC(  15)
    7    0/  2   6A( 144) 0C(  96) CF(  34) 14(  33) 16(  33) 18(  27)
    8    0/  1   3A( 152) 73(  41) 97(  35) 57(  28) 5A(  27) 9D(  27)
    9    0/  1   F1(  93) 2D(  45) 51(  29) 57(  27) 59(  27) 16(  26)
   10    2/  3   5B(  40) 53(  30) 59(  24) 2D(  15) 67(  15) 71(  12)
   11    0/  2   F5(  53) C6(  51) F0(  21) FB(  21) 17(  15) 77(  15)
   12    0/  2   E6(  88) F7(  81) D3(  36) E2(  32) E1(  29) D8(  27)
         {\color{red}\bf KEY FOUND! [ CE62B64E93E13B6A3AF15BF5E6 ]}
\end{alltt}
%$


\slide{Hvor lang tid tager det?}

\begin{list1}
\item Opsamling a data - ca. en halv time på 802.11b ved optimale forhold
\item Tiden for kørsel af aircrack fra auditor CD
på en Dell CPi 366MHz Pentium II laptop:
\end{list1}
\begin{alltt}
   $ time aircrack -n 128 -f 2 aftendump-128.cap
   ...
   real    5m44.180s   user  0m5.902s     sys  1m42.745s
   \end{alltt}
   %$
\pause
\begin{list1}
\item Tiden for kørsel af aircrack på en VIA CL-10000 1GHz CPU med
  almindelig disk OpenBSD:
\end{list1}
\begin{alltt}
   25.12s real     0.63s user     2.14s system
\end{alltt}

\exercise{ex:aircrack-ng}


\slide{RADIUS}
\begin{list1}
\item RADIUS er en protokol til autentificering af brugere op mod en
  fælles server
\item Remote Authentication Dial In User Service (RADIUS)
\item RADIUS er beskrevet i RFC-2865
\item RADIUS kan være en fordel i større netværk med
\begin{list2}
\item dial-in
\item administration af netværksudstyr
\item trådløse netværk
\item andre RADIUS kompatible applikationer
\end{list2}
\end{list1}


\slide{IEEE 802.1x  Port Based Network Access Control}

\hlkimage{10cm}{osx-8021x.png}

\begin{list2}
\item Nogle switche tillader at man benytter 802.1x
\item Denne protokol sikrer at man valideres før der gives adgang til porten
\item Når systemet skal have adgang til porten afleveres brugernavn og kodeord/certifikat
\item Denne protokol indgår også i WPA Enterprise
\end{list2}


\slide{802.1x og andre teknologier}

\begin{list1}
\item 802.1x i forhold til MAC filtrering giver væsentlige fordele
\item MAC filtrering kan spoofes, hvor 802.1x kræver det rigtige kodeord
\item Typisk benyttes RADIUS og 802.1x integrerer således mod både LDAP og Active Directory
\end{list1}




\slide{Erstatninger for WEP}
\begin{list1}
\item Der findes idag andre metoder til sikring af trådløse netværk
\item 802.1x Port Based Network Access Control
\item WPA - Wi-Fi Protected Access)\\
WPA = 802.1X + EAP + TKIP + MIC
\item nu WPA2\\
WPA2 = 802.1X + EAP + CCMP

\begin{quote}
WPA2 is based on the final IEEE 802.11i amendment to the 802.11
standard and is eligible for FIPS 140-2 compliance.
\end{quote}
\item Source:
\href{http://www.wifialliance.org/OpenSection/protected_access.asp}
{http://www.wifialliance.org/OpenSection/protected\_access.asp}
\end{list1}


\slide{WPA eller WPA2?}

\begin{quote}
WPA2 is based upon the Institute for Electrical and Electronics
Engineers (IEEE) 802.11i amendment to the 802.11 standard, which was
ratified on July 29, 2004.
\end{quote}

\begin{quote}
Q: How are WPA and WPA2 similar?\\
A: Both WPA and WPA2 offer a high level of assurance for end-users and network
administrators that their data will remain private and access to their
network restricted to authorized users.
Both utilize 802.1X and Extensible Authentication Protocol (EAP) for
authentication. Both have Personal and Enterprise modes of operation
that meet the distinct needs of the two different consumer and
enterprise market segments.

Q: How are WPA and WPA2 different?\\
A: WPA2 provides a {\bf stronger encryption mechanism} through {\bf
  Advanced Encryption Standard (AES)}, which is a requirement for some
corporate and government users.
\end{quote}

\centerline{Source: http://www.wifialliance.org WPA2 Q and A}

\slide{WPA Personal eller Enterprise}

\begin{list1}
\item Personal - en delt hemmelighed, preshared key
\item Enterprise - brugere valideres op mod fælles server
\item Hvorfor er det bedre?
\begin{list2}
\item Flere valgmuligheder - passer til store og små
\item WPA skifter den faktiske krypteringsnøgle jævnligt - TKIP
\item Initialisationsvektoren (IV) fordobles 24 til 48 bit
\item Imødekommer alle kendte problemer med WEP!
\item Integrerer godt med andre teknologier - RADIUS

\vskip 1 cm
\item EAP - Extensible Authentication Protocol - individuel autentifikation
\item TKIP - WPA Temporal Key Integrity Protocol - nøgleskift og integritet
\item MIC - Message Integrity Code - Michael, ny algoritme til integritet
\item CCMP - WPA2 AES / Counter Mode CBC-MAC Protocol
\end{list2}

\end{list1}


\slide{WPA cracking}

\begin{list1}
\item Nu skifter vi så til WPA og alt er vel så godt?
\pause
\item Desværre ikke!
\item Du skal vælge en laaaaang passphrase
\item Hvis koden til wifi er for kort kan man sniffe WPA
  handshake når en computer går ind på netværket, og knække den!
\item Med et handshake kan man med aircrack igen lave off-line
  bruteforce angreb!
\end{list1}

\slide{WPA cracking demo}

\begin{list1}
\item Vi konfigurerer AP med Henrik42 som WPA-PSK/passhrase
\item Vi finder netværk med airodump
\item Vi starter airodump mod specifik kanal
\item Vi spoofer deauth og opsamler WPA handshake
\item Vi knækker WPA :-)
\end{list1}

\centerline{Brug manualsiderne for programmerne i aircrack-ng pakken!}

\slide{WPA cracking med aircrack - start}

\begin{alltt}
\small
# aircrack-ng -w dict wlan-test.cap
Opening wlan-test.cap
Read 1082 packets.

#  BSSID              ESSID           Encryption

1  00:11:24:0C:DF:97  wlan            WPA (1 handshake)
2  00:13:5F:26:68:D0  Noea            No data - WEP or WPA
3  00:13:5F:26:64:80  Noea            No data - WEP or WPA
4  00:00:00:00:00:00                  Unknown

Index number of target network ? {\bf 1}
\end{alltt}

Aircrack-ng er en god måde at checke om der er et handshake i filen

\slide{WPA cracking med aircrack - start}

\begin{alltt}
\small
          [00:00:00] 0 keys tested (0.00 k/s)

                    KEY FOUND! [ Henrik42 ]

Master Key     : 8E 61 AB A2 C5 25 4D 3F 4B 33 E6 AD 2D 55 6F 76
                 6E 88 AC DA EF A3 DE 30 AF D8 99 DB F5 8F 4D BD
Transcient Key : C5 BB 27 DE EA 34 8F E4 81 E7 AA 52 C7 B4 F4 56
                 F2 FC 30 B4 66 99 26 35 08 52 98 26 AE 49 5E D7
                 9F 28 98 AF 02 CA 29 8A 53 11 EB 24 0C B0 1A 0D
                 64 75 72 BF 8D AA 17 8B 9D 94 A9 31 DC FB 0C ED

EAPOL HMAC     : 27 4E 6D 90 55 8F 0C EB E1 AE C8 93 E6 AC A5 1F

\end{alltt}

\vskip 1 cm

\centerline{Min gamle Thinkpad X31 med 1.6GHz Pentium M knækker ca. 150 Keys/sekund}

En mere moderne CPU kommer stadig ikke særligt højt, med WPA cracking, Hint: GPU




\slide{WPA cracking med Pyrit}

\begin{quote}
\emph{Pyrit} takes a step ahead in attacking WPA-PSK and WPA2-PSK, the protocol that today de-facto protects public WIFI-airspace. The project's goal is to estimate the real-world security provided by these protocols. Pyrit does not provide binary files or wordlists and does not encourage anyone to participate or engage in any harmful activity. {\bf This is a research project, not a cracking tool.}

\emph{Pyrit's} implementation allows to create massive databases, pre-computing part of the WPA/WPA2-PSK authentication phase in a space-time-tradeoff. The performance gain for real-world-attacks is in the range of three orders of magnitude which urges for re-consideration of the protocol's security. Exploiting the computational power of GPUs, \emph{Pyrit} is currently by far the most powerful attack against one of the world's most used security-protocols.
\end{quote}

\begin{list1}
\item \link{http://pyrit.wordpress.com/about/}
\item Also check out the Reaver brute force WPS\\ \link{https://code.google.com/p/reaver-wps/}
\end{list1}

\slide{ Wi-Fi Protected Setup, WPS hacking - Reaver}

\begin{quote}
How Reaver Works
Now that you've seen how to use Reaver, let's take a quick overview of how Reaver works. The tool takes advantage of a vulnerability in something called Wi-Fi Protected Setup, or WPS. It's a feature that exists on many routers, intended to provide an easy setup process, and it's tied to a PIN that's hard-coded into the device. Reaver exploits a flaw in these PINs; the result is that, with enough time, it can reveal your WPA or WPA2 password.
\end{quote}

\centerline{Hvad betyder ease of use?}

Source: \\
\link{https://code.google.com/p/reaver-wps/}\\
{\footnotesize \link{http://lifehacker.com/5873407/how-to-crack-a-wi+fi-networks-wpa-password-with-reaver}}

\slide{WPS Design Flaws used by Reaver }

\hlkimage{18cm}{wps-design-flaw-1.png}

\centerline{Pin only, no other means necessary}

Source:\\
\link{http://sviehb.files.wordpress.com/2011/12/viehboeck_wps.pdf}


\slide{WPS Design Flaws used by Reaver }

\hlkimage{10cm}{wps-design-flaw-2.png}

\centerline{Reminds me of NTLM cracking, crack parts independently}

Source:\\
\link{http://sviehb.files.wordpress.com/2011/12/viehboeck_wps.pdf}







\slide{DNSSEC trigger}

\hlkimage{7cm}{dnssec-trigger.png}

Lots of DNSSEC tools, I recommend DNSSEC-trigger a local name server for your laptop

\begin{list2}
\item DNSSEC Validator for firefox\\ \link{https://addons.mozilla.org/en-us/firefox/addon/dnssec-validator/}
\item OARC tools \link{https://www.dns-oarc.net/oarc/services/odvr}
\item \link{http://www.nlnetlabs.nl/projects/dnssec-trigger/}
\end{list2}

\slide{DNSSEC NSEC walk the zone}

\begin{quote}
DNSSEC:NSEC vs. NSEC3

The Domain Name System Security Extensions(DNSSEC) provide two different records for securely handling non-existent names in DNS, NSEC and NSEC3. They are mutually exclusive, so operators need to pick one when deploying DNSSEC.

The problem both NSEC and NSEC3 solve is knowing when a name exists within a given zone. This is required to prevent malicious actors from sending fake negative responses to queries.

... the challenge with the plain NSEC record is that someone could use the NSEC responses to “walk the zone” and build a list of all of the records in a DNS zone.
\end{quote}

Source:\\
{\small\link{http://www.internetsociety.org/deploy360/resources/dnssec-nsec-vs-nsec3/}}

Perhaps try \link{http://josefsson.org/walker/}


\slide{DANE}

\begin{quote}
Objective:

Specify mechanisms and techniques that allow Internet applications to
establish cryptographically secured communications by using information
distributed through DNSSEC for discovering and authenticating public
keys which are associated with a service located at a domain name.
\end{quote}

DNS-based Authentication of Named Entities (dane)\\
\link{https://datatracker.ietf.org/wg/dane/charter/}\\
{\footnotesize \link{http://googleonlinesecurity.blogspot.dk/2011/04/improving-ssl-certificate-security.html}}

\vskip 2cm

\centerline{\Large DNSSEC er ved at være godt udbredt - undtagen i DK}
(findes på .dk zonen, men næsten ingen resolvere)


\slide{Are your data secure - data at rest}

\hlkimage{15cm}{images/data-integrity-1.pdf}

\begin{list1}
\item Stolen laptop, tablet, phone - can anybody read your data?
\item Do you trust "remote wipe"
\item How do you in fact wipe data securely off devices, and SSDs?
\item Encrypt disk and storage devices before using them in the first place!
\end{list1}


\slide{Circumvent security - single user mode boot}
\begin{list1}
\item Unix systems often allows boot into singleuser mode\\
press command-s when booting Mac OS X
\item Laptops can often be booted using PXE network or CD boot
\item Mac computers can become a Firewire disk\\
hold t when booting - firewire target mode
\item Unrestricted access to un-encrypted data
\item Moving hard drive to another computer is also easy
\end{list1}
\pause
\centerline{Physical access is often - {\bf game over}}


\slide{Encrypting hard disk}

\hlkimage{10cm}{images/apple-filevault.png}

\begin{list1}
\item Becoming available in the most popular client operating systems
\begin{list2}
\item Microsoft Windows Bitlocker - requires Ultimate or Enterprise
\item Apple Mac OS X - FileVault og FileVault2
\item FreeBSD GEOM og GBDE - encryption framework
\item Linux LUKS distributions like Ubuntu ask to encrypt home dir during installation
\item PGP disk - Pretty Good Privacy - makes a virtuel krypteret disk
\item TrueCrypt - similar to PGP disk, a virtual drive with data, cross platform
\item Some vendors have BIOS passwords, or disk passwords
\end{list2}
\end{list1}



\slide{Attacks on disk encryption}

\begin{list1}
\item Firewire, DMA \& Windows, Winlockpwn via FireWire\\
Hit by a Bus: Physical Access Attacks with Firewire Ruxcon 2006
\vskip 5mm
\item Removing memory from live system - data is not immediately lost, and can be read under some circumstances\\
Lest We Remember: Cold Boot Attacks on Encryption Keys\\
\link{http://citp.princeton.edu/memory/}
\item This is very CSI or Hollywoord like - but a real threat
\item VileFault decrypts encrypted Mac OS X disk image files\\ \link{https://code.google.com/p/vilefault/}

\item  FileVault Drive Encryption (FVDE) (or FileVault2) encrypted volumes\\
\link{https://code.google.com/p/libfvde/}
\end{list1}

\centerline{So perhaps use both hard drive encryption AND turn off computer after use?}

\slide{... and deleting data}

\hlkimage{10cm}{dban-screenshot.png}

\begin{list1}
\item Getting rid of data from old devices is a pain
\item Some tools will not overwrite data, leaving it vulnerable to recovery
\item Even secure erase programs might not work on SSD - due to reallocation of blocks
\item I have used Darik's Boot and Nuke ("DBAN") \link{http://www.dban.org/}
\end{list1}



\slidenext{}

\end{document}
